# 背景 #

采集模块是网管软件最为基础的模块，支撑网管软件上层业务。一个采集模块的质量直接决定着网管理软件的质量，因此它是整个网管软件的重中之重。
采集模块是复杂的，原因是：

1. 它要面对的是种类繁多的被管设备（或软件），它们参差不齐，它们的访问协议复杂众多，它们可能很快回复请求，可能很慢才回复请求，甚至不回复或回复错误。然而面对这些被管设备（或软件）却要向上层提供统一而稳定的接口
2. 同样地它面对的上层也是有多种，它需要满足来自不同的上层的需求。

如何满足第1条是影响采集模块的架构的主要因素，我这里主要讨论接口的设计，接口的设计如何影响架构我也不讨论了。


# 接口风格 #

## 用户 ##
采集模块接口按易用性可以分为两种：

1. 人可读的，其接口是显性的，人可以理解，不包含任何内部数据。
2. 人不可读的，则正好相反

接口有无数据库（有数据库指采集层可以访问到或自带数据库）也可分为两种：

1. 有数据库，其接口中可以不包含完整的访问参数，如用户名密码之类的
2. 无数据库，则必须包含完整的访问参数


## 思路 ##

以上需求都是必须满足的，那么只能同时实现多种接口，但每种都完整实现又太复杂了，因此可以只实现一种接口，然后其它地接口在内部转换为这一种接口。

人不可读的接口之所以不可读主要是因为含有人不能理解的内部数据（如Id）导致的，因此上述接口可以归纳为三种

1. 人可读的且无数据库
2. 人不可读的且有数据库
3. 人可读的且有数据库，它将人可读的且无数据库很相似，或者说是一种特例即没有访问参数（访问参数将从数据库中自动读取）

我们选择第一个为主要接口，其它为辅助接口。

# 接口的内容 #

采集模块的接口将会是一个 restful 风格的 http 接口，它的接口规格和约束基本上以定下来了。这时仅讨论一下接口的内容。

一个被管设备（或软件）内部可能包含多个子模块，这些子模块功能可能相同可相不相同，而且它们可能还包含子子模块，子子模块可能还包含子子子模块等等。

为了访问这些子模块，那么必须有一个方式来表示它，解决方案的前题是这些子模块都有一个区别于其它同层次子模块的key（当然也有特例）, 如此我们就可以

因此我们针对上面三种接口设计如下： 

1.  人可读的且无数据库  -- 我们设计一个类似于文件系统的路径，当然它没有相对路径的说法。格式如下

         <被管设备类型名>/<被管设备地址>/子模块类型/子模块key/子子模块类型/子子模块key .......

    一个模块有多个属性，可能会有多个属性都可以成为key, 那么哪个属性为key呢，这个不是那么重要，只要采集模块和用户只要一致就行，可以统一由采集模块的人员决定，并在采集模块的开发文档中说明即可。


2. 人不可读的且有数据库 -- 它分成三种情况：

    a. 被管设备（或软件）的表达：

         <被管设备类型名>/<被管设备在数据库的id>

    b. 子模块在数据库中，这时我们只要写成:

         <子模块类型>/<子模块在数据库的id>

    c. 子模块不在数据库中，这时我们可以写成 “人可读的且无数据库”+ “人不可读的且有数据库” 的混合:

         <被管设备类型名>/<被管设备在数据库的id>/<子模块类型>/<子模块key>
         <子模块类型>/<子模块在数据库的id>/<子子模块类型>/<子子模块key>
         <子模块类型>/<子模块在数据库的id>/<子子模块类型>/<子子模块key>/<子子子模块类型>/<子子子模块key>
         ......


3. 人可读的且有数据库  -- 它应该与“人可读的且无数据库”完全一致。

## 访问多个子模块 ##

以上说明了如何访问某类子模块，那么如何访问某一类子模块呢，很简单按 rest 的原则去除最后的“key”或“id”。 

也许你可能只想访问某类子模块中的某几个，即过滤一下，可以尝试向url的 querystring 学习一下。这个可能在一期不做因此也不说了。 


## 特例 ##

有一类子模块将无法唯一标识，典型是服务器上的进程，一些重要的服务如mysql对用户来说很重要希望监控它的进程是否正常。但是进程有一个pid可以唯一标识，便是对网管来说它毫无意义，因为每次系统重启后都会不一样，为此可以做一个特殊处理，以其它字段作为key如name，当然也需要在文档中说明。





