<?xml version="1.0" encoding="UTF-8"?>
<classDefinitions lastModified="2013-02-13T08:57:30" xmlns="http://schemas.meijing.com.cn/mdbs/1/typeDefinitions" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://schemas.meijing.com.cn/mdbs/1/typeDefinitions typeDefinitions.xsd">
  <class name="ManagedObject" abstract="true">
    <property name="description">
      <restriction base="string">
        <maxLength>2000</maxLength>
      </restriction>
    </property>
    <property name="created_at">
      <restriction base="datetime">
        <readonly />
      </restriction>
    </property>
    <property name="updated_at">
      <restriction base="datetime">
      </restriction>
    </property>

    <has_many foreignKey="managed_object_id" >Attributes</has_many>
    <has_many polymorphic="true" >Trigger</has_many>
  </class>

  <class name="NetworkDevice" base="ManagedObject">
    <property name="type">
      <restriction base="string">
        <required />
      </restriction>
    </property>
    
    <property name="name">
      <restriction base="string">
        <required />
        <minLength>1</minLength>
        <maxLength>200</maxLength>
      </restriction>
    </property>

    <property name="zh_name">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>

    <property name="address">
      <restriction base="ipAddress">
        <required />
      </restriction>
    </property>
    
    <property name="memo">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>

    <property name="manufacturer">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>

    <property name="device_type">
      <restriction base="integer">
      </restriction>
    </property>

    <property name="owner">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>

    <property name="oid">
      <restriction base="string">
      </restriction>
    </property>

    <property name="location">
      <restriction base="string">
				<maxLength>2000</maxLength>
      </restriction>
    </property>

	  <has_many foreignKey="device_id" >NetworkDevicePort</has_many>
    <has_many foreignKey="device_id" >NetworkAddress</has_many>
    <has_many foreignKey="from_device" >NetworkLink</has_many>
    <has_many foreignKey="to_device" >NetworkLink</has_many>
  </class>

  <class name="Switch" base="NetworkDevice">
  </class>

  <class name="Route" base="NetworkDevice">
  </class>

  <class name="SwitchRoute" base="NetworkDevice">
  </class>


  <class name="NetworkDevicePort" base="ManagedObject">
    <property name="if_index">
      <restriction base="integer">
        <required />
      </restriction>
    </property>
    <property name="if_descr">
      <restriction base="string">
        <maxLength>2000</maxLength>
      </restriction>
    </property>
    <property name="if_type">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="if_mtu">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="if_speed">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="if_physAddress">
      <restriction base="physicalAddress">
      </restriction>
    </property>
    <belongs_to name="device_id" >NetworkDevice</belongs_to>
  </class>


  <class name="NetworkAddress" base="ManagedObject">
    <property name="address">
      <restriction base="ipAddress">
        <required />
      </restriction>
    </property>
    <property name="ifIndex">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="netmask">
      <restriction base="ipAddress">
      </restriction>
    </property>
    <property name="bcastAddress">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="reasmMaxSize">
      <restriction base="integer">
      </restriction>
    </property>
    <belongs_to name="device_id" >NetworkDevice</belongs_to>
  </class>


  <class name="NetworkLink" base="ManagedObject">
    <property name="name">
      <restriction base="string">
        <required />
        <minLength>1</minLength>
        <maxLength>200</maxLength>
      </restriction>
    </property>
    <property name="custom_speed_up">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="custom_speed_down">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="description">
      <restriction base="string">
        <maxLength>2000</maxLength>
      </restriction>
    </property>
    <property name="from_device">
      <restriction base="objectId">
        <required />
      </restriction>
    </property>
    <property name="from_if_index">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="to_device">
      <restriction base="objectId">
        <required />
      </restriction>
    </property>
    <property name="to_if_index">
      <restriction base="integer">
      </restriction>
    </property>

    <belongs_to name="from_device" >NetworkDevice</belongs_to>
    <belongs_to name="to_device" >NetworkDevice</belongs_to>
  </class>

  <class name="Attributes" abstract="true">
    <belongs_to>ManagedObject</belongs_to>
  </class>

  <class name="AccessParam" base="Attributes" abstract="true">
  </class>

  <class name="EndpointParam" base="AccessParam" abstract="true">
    <property name="port">
      <restriction base="integer">
        <required />
      </restriction>
    </property>
  </class>

  <class name="SnmpParam" base="EndpointParam">
    <property name="version">
      <restriction base="string">
        <required />
        <enumeration value="snmp_v1" />
        <enumeration value="snmp_v2c" />
        <enumeration value="snmp_v3" />
      </restriction>
    </property>
    <property name="read_community">
      <restriction base="password">
      </restriction>
    </property>
    <property name="write_community">
      <restriction base="password">
      </restriction>
    </property>
    <property name="sec_model">
      <restriction base="string">
        <maxLength>50</maxLength>
      </restriction>
    </property>

    <property name="read_sec_name">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>

    <property name="read_auth_pass">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>

    <property name="read_priv_pass">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>


    <property name="write_sec_name">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>

    <property name="write_auth_pass">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>

    <property name="write_priv_pass">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>

    <property name="max_msg_size">
      <restriction base="integer">
        <minValue>1024</minValue>
        <minValue>10240</minValue>
      </restriction>
    </property>

    <property name="context_name">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>

    <property name="identifier">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>    

    <property name="engine_id">
      <restriction base="string">
        <maxLength>250</maxLength>
      </restriction>
    </property>

  </class>

  <class name="SshParam" base="EndpointParam">
    <property name="user_name">
      <restriction base="string">
      </restriction>
    </property>
    <property name="user_password">
      <restriction base="password">
      </restriction>
    </property>
  </class>

  <class name="WbemParam" base="AccessParam">
    <property name="url">
      <restriction base="string">
        <required />
      </restriction>
    </property>
    <property name="user_name">
      <restriction base="string">
      </restriction>
    </property>
    <property name="user_password">
      <restriction base="password">
      </restriction>
    </property>
  </class>


  <class name="Trigger" abstract="true">
    <property name="name">
      <restriction base="string">
        <required />
      </restriction>
    </property>
    <property name="expression">
      <restriction base="string">
        <required />
        <maxLength>200</maxLength>
      </restriction>
    </property>
    <property name="attachment">
      <restriction base="string">
        <maxLength>2000</maxLength>
      </restriction>
    </property>
    <property name="description">
      <restriction base="string">
        <maxLength>2000</maxLength>
      </restriction>
    </property>
    <has_many polymorphic="true">Action</has_many>
  </class>

  <class name="Action" abstract="true">
    <property name="name">
      <restriction base="string">
        <required />
        <unique />
      </restriction>
    </property>
    <property name="description">
      <restriction base="string">
        <maxLength>2000</maxLength>
      </restriction>
    </property>
  </class>

  <class name="RedisCommand" base="Action">
    <property name="command">
      <restriction base="string">
        <maxLength>10</maxLength>
      </restriction>
    </property>
    <property name="arg0">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>
    <property name="arg1">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>
    <property name="arg2">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>
    <property name="arg3">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>
    <property name="arg4">
      <restriction base="string">
        <maxLength>200</maxLength>
      </restriction>
    </property>
  </class>


  <class name="Alert" base="Action">
    <property name="max_repeated">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="expression_style">
      <restriction base="string">
        <maxLength>50</maxLength>
      </restriction>
    </property>
    <property name="expression_code">
      <restriction base="string">
        <maxLength>2000</maxLength>
        <!-- 
          json:
            attribute string 
            operator  string  
            value     string 
        -->
      </restriction>
    </property>
  </class>

  <class name="MetricTrigger" base="Trigger">
    <property name="metric">
      <restriction base="string">
        <required />
      </restriction>
    </property>
    <belongs_to>ManagedObject</belongs_to>
  </class>
  
  <!-- For Test as Follow
   * Magazine       extends PrintedDocument extends Document{documents}
   * Book    extends PrintedDocument extends Document{documents}
   * OnlineTutorial extends OnlineDocument  extends Document{documents}
   * HelpFile       extends OnlineDocument  extends Document{documents}
   *
   * Document       --has many--   ZipFile
   * OnlineDocument --belongs to-- Website
   * HelpFile       --has many--   Topic
   * PrintedBook    --belongs to-- Printer
   -->
  <class name="Document">
    <property name="name">
      <restriction base="string">
        <required />
        <maxLength>100</maxLength>
      </restriction>
    </property>
    <property name="publish_at">
      <restriction base="integer">
        <required />
      </restriction>
    </property>
    <property name="type">
      <restriction base="string">
        <required />
      </restriction>
    </property>
    <has_many>ZipFile</has_many>
  </class>
  <class name="PrintedDocument" base="Document">
    <property name="page_count">
      <restriction base="integer">
      </restriction>
    </property>
  </class>
  <class name="OnlineDocument" base="Document">
    <property name="bytes">
      <restriction base="integer">
      </restriction>
    </property>
    <property name="website_id">
      <restriction base="objectId">
        <required />
      </restriction>
    </property>
    <belongs_to>Website</belongs_to>
  </class>
  <class name="Magazine" base="PrintedDocument">
    <property name="journal_id">
      <restriction base="integer">
      </restriction>
    </property>
  </class>
  <class name="Book" base="PrintedDocument">
    <property name="author">
      <restriction base="string">
        <maxLength>100</maxLength>
      </restriction>
    </property>
    <property name="isbn">
      <restriction base="string">
        <maxLength>100</maxLength>
      </restriction>
    </property>
    <property name="printer_id">
      <restriction base="objectId">
      </restriction>
    </property>
    <belongs_to>Printer</belongs_to>
  </class>
  <class name="OnlineTutorial" base="OnlineDocument">
  </class>
  <class name="HelpFile" base="OnlineDocument">
    <property name="compressed_format">
      <restriction base="string">
        <maxLength>100</maxLength>
      </restriction>
    </property>
    <has_many>Topic</has_many> 
  </class>
  <class name="ZipFile">
    <property name="body">
      <restriction base="string">
        <required />
      </restriction>
    </property>
  </class>
  <class name="Website">
    <property name="url">
      <restriction base="string">
        <required />
      </restriction>
    </property>
  </class>
  <class name="Topic">
    <property name="name">
      <restriction base="string">
        <required />
      </restriction>
    </property>
  </class>
  <class name="Printer">
    <property name="name">
      <restriction base="string">
        <required />
      </restriction>
    </property>
  </class>
</classDefinitions>